name: Sync pm directory from AOSP

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  sync-pm-directory:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          repository: Jesusdio2/Jesusdio2-Android

      - name: Clone AOSP frameworks/base
        run: |
          git clone --depth=1 --branch android16-release https://android.googlesource.com/platform/frameworks/base aosp-base

      - name: Copy pm directory
        run: |
          mkdir -p platform/frameworks/base/services/core/java/com/android/server/
          cp -r aosp-base/services/core/java/com/android/server/pm platform/frameworks/base/services/core/java/com/android/server/

      - name: Commit pm directory
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add platform/frameworks/base/services/core/java/com/android/server/pm
          git diff --cached --quiet || git commit -m "Sync pm directory from AOSP"
          git push
